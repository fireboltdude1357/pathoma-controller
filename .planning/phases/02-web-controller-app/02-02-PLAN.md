---
phase: 02-web-controller-app
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - app/page.tsx
  - app/components/ConnectionStatus.tsx
autonomous: false

must_haves:
  truths:
    - "Web app shows connection status indicator (connected/disconnected to Convex)"
  artifacts:
    - path: "app/components/ConnectionStatus.tsx"
      provides: "Visual connection status indicator"
      min_lines: 20
      exports: ["ConnectionStatus"]
    - path: "app/page.tsx"
      provides: "Page with ConnectionStatus component"
      contains: "ConnectionStatus"
  key_links:
    - from: "app/components/ConnectionStatus.tsx"
      to: "convex/react"
      via: "useConvex hook for connection state"
      pattern: "useConvex|connectionState"
---

<objective>
Add connection status indicator showing Convex connection state, then verify complete Phase 2 functionality.

Purpose: Users need visual feedback about whether commands will be delivered (connection status addresses requirement CONN-01).
Output: ConnectionStatus component showing connected/disconnected/connecting state, integrated into controller page.
</objective>

<execution_context>
@/Users/tannersharon/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tannersharon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@app/page.tsx
@app/providers.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConnectionStatus component</name>
  <files>app/components/ConnectionStatus.tsx</files>
  <action>
Create a connection status indicator component:

1. Create app/components/ directory if needed
2. Create ConnectionStatus.tsx with "use client" directive
3. Use Convex's useConvex() hook to get the client
4. Access connection state via client.connectionState() or similar (check Convex React docs pattern)
5. Display visual indicator:
   - Green dot + "Connected" when connected
   - Yellow dot + "Connecting..." when connecting
   - Red dot + "Disconnected" when disconnected
6. Style with Tailwind:
   - Small, unobtrusive (fits in header or footer)
   - Colored dots using bg-green-500, bg-yellow-500, bg-red-500
   - Subtle text (text-sm, text-zinc-500)

Note: If useConvex().connectionState() is not directly available, check if there's a useSyncState hook or similar. The Convex React client exposes connection state - find the right pattern.
  </action>
  <verify>
1. Component file exists at app/components/ConnectionStatus.tsx
2. No TypeScript errors
3. Export is correct
  </verify>
  <done>
ConnectionStatus component created with visual indicator for connected/disconnected/connecting states.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate ConnectionStatus into page</name>
  <files>app/page.tsx</files>
  <action>
Add the ConnectionStatus component to the controller page:

1. Import ConnectionStatus from ./components/ConnectionStatus
2. Add to the header area (near UserButton) or footer
3. Show in both SignedIn and SignedOut states (connection status is useful regardless of auth)

Keep the layout clean - the status indicator should be visible but not distracting.
  </action>
  <verify>
1. Run `npm run dev`
2. Visit localhost:3000
3. Connection status indicator visible
4. Shows "Connected" when Convex is connected
5. If you stop Convex dev server, should show "Disconnected"
  </verify>
  <done>
ConnectionStatus component visible on page, accurately reflecting Convex connection state.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 2 web controller with auth, command buttons, and connection status</what-built>
  <how-to-verify>
1. Visit http://localhost:3000 (start dev server if needed: `npm run dev`)
2. Verify connection status indicator shows "Connected" (green)
3. Click "Sign In" and authenticate via Clerk
4. After sign-in, verify:
   - UserButton visible in header
   - All command buttons visible (play, pause, seek, speed)
   - Connection status still visible
5. Click several buttons (play, seek back 10s, speed up)
6. Open Convex dashboard and verify commands appear in commands table with correct types/amounts
7. (Optional) Stop Convex dev server and verify status shows "Disconnected"
  </how-to-verify>
  <resume-signal>Type "approved" if all verification steps pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. ConnectionStatus component exists and compiles
2. Connection status visible on page
3. Status accurately reflects Convex connection (green when connected)
4. All Phase 2 success criteria met (see phase roadmap)
</verification>

<success_criteria>
- [ ] ConnectionStatus component created in app/components/
- [ ] Status indicator visible on main page
- [ ] Shows correct state (connected/disconnected/connecting)
- [ ] Full phase verified: auth + commands + connection status all working
</success_criteria>

<output>
After completion, create `.planning/phases/02-web-controller-app/02-02-SUMMARY.md`
</output>
