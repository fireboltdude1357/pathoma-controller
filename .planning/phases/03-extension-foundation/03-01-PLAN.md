---
phase: 03-extension-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [extension/manifest.json, extension/background.ts, extension/tsconfig.json]
autonomous: true

must_haves:
  truths:
    - "Extension loads in Chrome without errors"
    - "Extension only activates on pcloud.link URLs"
    - "Service worker registers and runs"
  artifacts:
    - path: "extension/manifest.json"
      provides: "Manifest V3 configuration"
      contains: "manifest_version.*3"
    - path: "extension/background.ts"
      provides: "Service worker entry point"
      min_lines: 10
    - path: "extension/tsconfig.json"
      provides: "TypeScript config for extension"
  key_links:
    - from: "extension/manifest.json"
      to: "extension/background.ts"
      via: "service_worker field"
      pattern: "background.*service_worker"
---

<objective>
Create Chrome extension skeleton with Manifest V3 configuration targeting pcloud.link tabs.

Purpose: Establish extension foundation that can be loaded in Chrome and targets only pcloud.link
Output: Loadable extension with service worker entry point
</objective>

<execution_context>
@/Users/tannersharon/.claude/get-shit-done/workflows/execute-plan.md
@/Users/tannersharon/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create extension manifest and TypeScript config</name>
  <files>extension/manifest.json, extension/tsconfig.json</files>
  <action>
Create extension directory at project root.

Create extension/manifest.json with Manifest V3:
- name: "Pathoma Controller"
- description: "Remote video control for pcloud.link"
- version: "1.0.0"
- manifest_version: 3
- permissions: ["storage"] (for auth state persistence)
- host_permissions: ["*://*.pcloud.link/*", "*://u.pcloud.link/*"]
- background.service_worker: "background.js" (compiled output)
- background.type: "module"

Create extension/tsconfig.json:
- target: ES2020
- module: ES2020
- moduleResolution: bundler
- strict: true
- outDir: dist
- rootDir: .
- lib: ["ES2020", "DOM"]

Note: We use DOM lib for service worker globals (fetch, WebSocket, etc.) even though we're not in browser context.
  </action>
  <verify>
cat extension/manifest.json | grep -q '"manifest_version": 3' && echo "Manifest OK"
cat extension/tsconfig.json | grep -q '"module": "ES2020"' && echo "TSConfig OK"
  </verify>
  <done>
- manifest.json exists with MV3 config
- host_permissions include pcloud.link patterns
- tsconfig.json configured for ES modules
  </done>
</task>

<task type="auto">
  <name>Task 2: Create service worker entry with logging</name>
  <files>extension/background.ts</files>
  <action>
Create extension/background.ts as the service worker entry point:

```typescript
// Service worker lifecycle
console.log('[Pathoma Controller] Service worker starting');

// Listen for install
self.addEventListener('install', () => {
  console.log('[Pathoma Controller] Service worker installed');
});

// Listen for activate
self.addEventListener('activate', () => {
  console.log('[Pathoma Controller] Service worker activated');
});

// Placeholder for Convex subscription (Plan 02)
// Will be replaced with actual Convex client setup

export {};
```

This minimal service worker establishes the lifecycle hooks that will be extended in Plan 02.
  </action>
  <verify>
cat extension/background.ts | grep -q "Service worker" && echo "Background script OK"
  </verify>
  <done>
- background.ts exists with service worker lifecycle handlers
- Logs service worker install and activate events
  </done>
</task>

<task type="auto">
  <name>Task 3: Add build script and compile extension</name>
  <files>package.json, extension/dist/</files>
  <action>
Add build script to root package.json scripts:
```json
"build:extension": "tsc -p extension/tsconfig.json"
```

Run the build:
```bash
npm run build:extension
```

Verify extension/dist/background.js is created.

Note: For development, we're using simple tsc compilation. A bundler (esbuild) will be needed in Plan 02 when we add Convex dependencies.
  </action>
  <verify>
npm run build:extension && ls extension/dist/background.js && echo "Build OK"
  </verify>
  <done>
- build:extension script added to package.json
- extension/dist/background.js generated successfully
- Extension can be loaded in Chrome via "Load unpacked" pointing to extension directory
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. Extension directory exists with manifest.json, background.ts, tsconfig.json
2. npm run build:extension compiles without errors
3. Extension can be loaded in Chrome (chrome://extensions -> Load unpacked -> select extension folder)
4. Service worker shows "installed" and "activated" in chrome://serviceworker-internals
</verification>

<success_criteria>
- Extension loads in Chrome without manifest errors
- Service worker lifecycle logs appear in service worker devtools
- Extension only shows in toolbar on pcloud.link tabs (due to host_permissions)
</success_criteria>

<output>
After completion, create `.planning/phases/03-extension-foundation/03-01-SUMMARY.md`
</output>
